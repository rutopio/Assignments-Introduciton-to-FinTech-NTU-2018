# Introduction to FinTech Final Project

## B05102074 何青儒 2019 Jan

***

## 所使用的技術指標

- MA（移動平均，Moving Average，這裡用的是 DEMA 跟 TEMA）
- RSI（相對強弱指數，Relative Strength Index）

## 執行買賣的概念

和簡單的 RSI 策略類似的概念。

在 RSI 過高時（如高於 70，代表市場呈現超買狀態）賣出，在 RSI 過低時（如低於 30，代表市場呈現超賣狀態）買入。

### RSI

RSI，Relative Strength Index，相對強弱指數：

$$
RSI_n = \frac{EMA_{(U,n)}}{EMA_{(U,n)}+EMA_{(D,n)}} \times 100 \%
$$

其中 $$U$$ 代表當日價格比昨天高時，$$當日市價 - 昨日市價$$；而 $$D$$ 代表當日價格比昨天低時，$$昨日市價 - 今日市價$$。而 $$EMA_{(U,n)}$$ 則是取 $$U$$ 在 $$n$$ 日內的指數平均值（Exponential Moving Average），$$EMA_{(D,n)}$$ 則是取 $$D$$ 在 $$n$$ 日內的指數平均值。

RSI 的基礎建立在市場是呈現「動量振盪」的概念。在一個正常、不受操作的市場中，多空雙方的力道必呈現均衡。否則當多方強於空方，或是空方強於多方，都會使某一個方向不均衡。股價或是標的價格也不可能毫無理由的永遠上揚或是永遠下跌，所以市場會有超買、超賣、整理、交叉、反轉的情況發生。

因此，我們可將 RSI 視作多空氣勢強弱的指標，來掌握整體趨勢。以 $$RSI=50$$ 作為多空交戰均衡點，當 RSI 值在 50 以上時視為多頭；當 RSI 值在 50 以下時視為空頭。當 RSI 過高時，代表市場嚴重超買，價格隨時都會回檔補正；而當 RSI 過小時，表示市場嚴重超賣，價格隨時會反彈。

但單純的 RSI 策略在進行買賣時會有一個盲點，它只單純把兩個上下界（如上面的 70 和 30）應用在整個市場中，而沒有考慮到當今市場是「熊市」還是「牛市」。

如果是牛市，那本來市場就會呈現熱絡狀態，RSI 的低點會比平常還高，如果我們還是設成跟熊市一樣，那在牛市時會找不到買點買入，因為可能都不會低到我們所設的值；而高點也是一樣，如果我們還是設成一樣熊市一樣，那我們會太早賣出而得不到更大的利潤。

因此，在牛市時我們應該將我們所設的 RSI 低值和高值向上調整。

反之，在熊市時我們應該將我們所設的 RSI 低值和高值向下調整。

### MA

而我們簡單判斷當今市場是牛市或熊市的方法就是用長均線和短均線是否交叉，我們假設在買賣的當下，長均線在短均線之上，代表近期趨勢走勢低於長期趨勢，視為熊市，而若長均線在短均線之下，代表近期趨勢走勢高於長期趨勢，視為牛市。

這裡的移動平均用的是 EMA，Exponential Moving Average，指數移動平均：

$$
EMA_n = \alpha x(n)+(1-\alpha)EMA_{n-1}
$$

其中，$$x(n)$$ 是第 $$n$$ 天的價格，$$EMA_n$$ 代表第 $$n$$ 天的 EMA，而 $$\alpha$$ 是一個參數，必在 0 和 1 之間，通常讓 $$\alpha=2/(N+1)$$，$$N$$ 是要應用的天數。由於 EMA 是一個遞迴方程式，理論上他是無窮級數，但因為 $$0 < 1-\alpha < 1$$，越過去的 EMA 會趨近於零，故他是一種以指數式遞減加權的移動平均。

而 DEMA，Double Exponential Moving Average，二重 EMA，則是將 EMA 加權兩次。

$$
DEMA_n = 2EMA[x(n)]-EMA[EMA[x(n)]]
$$

而 TEMA，Triple Exponential Moving Average，三重 EMA，則是將 EMA 加權三次。

$$
TEMA_n = 3EMA[x(n)]-3EMA[EMA[x(n)]]+EMA[EMA[EMA[x(n)]]]
$$

如下圖所示，下圖是台指期的日 K 走勢，其中藍線是原始的 EMA（以下接以五天為單位計算），綠線是 DEMA，紅線是 TEMA。之所以使用 DEMA 跟 TEMA，是因為他們對原本的 EMA 做了多次的加權計算，會讓計算出來的曲線更接近原始的價格資料。

<img src="/home/chingru/圖片/擷取選取區域_059.png">

## 策略所包含的參數

共九個：

1. `ma_long_day`：我們要參考的 MA 長期趨勢天數
2. `ma_short_day`：我們要參考的 MA 短期趨勢天數
3. `rsi_day`：我們要參考的 RSI 天數
4. `ma_long_type`：在計算長線 MA 時，我們採取的 MA 算法
5. `ma_short_type`：在計算短線 MA 時，我們採取的 MA 算法

在 python 的 talib 裡，0 代表 SMA，1 代表 EMA，2 代表WMA（加權 MA），3 代表 DEMA，4 代表 TEMA 。

6. `bull_rsi_high`：牛市時 RSI 高值，超過這個值就賣
7. `bull_rsi_low`：牛市時 RSI 低值，超過這個值就買

8. `bear_rsi_high`：熊市時 RSI 高值，超過這個值就賣
9. `bear_rsi_low`：牛市時 RSI 低值，超過這個值就買

## 參數判斷

假設市場會對預期自我實現，那麼單一市場的走勢會和其他市場走勢接近，因此參考我對股市的理解對參數做調整：

- `ma_long_day`：只考慮 30 天以上 60 天以下，太短就不具有長期趨勢
- `ma_short_day`：考慮 3 到 5 天，太長就不較短期趨勢
- `rsi_day`：考慮 3 到 7 天，發明 RSI 指標的人認為 14 天剛好，但我認為太長的 RSI 會失去敏銳度
- `ma_long_type`：只考慮 DEMA 和 TEMA，因為經多次計算後會更符合真實走勢
- `ma_short_type`：只考慮 DEMA 和 TEMA ，因為經多次計算後會更符合真實走勢
- `bull_rsi_high`：假設牛市 RSI 理想高值恆不會低於 50 且不高於 70 以上
- `bull_rsi_low`：假設牛市RSI理想低值恆不會低於 40 且不高於`bull_rsi_high`值
- `bear_rsi_high`：假設熊市 RSI 理想高值恆不會低於 40 且不高於 70 以上
- `bear_rsi_low`：假設熊市 RSI 理想低值恆不會低於且不高於`bear_rsi_high`

## 結論

這裡只單純把市場拆分成牛和熊兩種，或許可以再拆分成小牛市、大牛市、小熊市、大熊市等更細的拆分。

### 為什麼要用技術指標？

技術指標做出的圖形會先在市場上自我實現，進而強化趨勢，一旦價格突破多數人認為的頸線開始接近阻力位，便開始吸引更多的買家想逢低買入，市場買單增加價格自然上升。接著超越一般人的預期，吸引更多買家進場畫圖分析，並對當下的線型做更高的預期，新的阻力位和支撐位就此生成，而這個更高的預期，也正是自我毀滅的開始。

這也不是說我不相信技術指標，既然市場會回應技術指標的自我實現，那麼技術指標仍然有他的存在意義。

### 為什麼不用機器學習？

機器學習有很多種方法就是了，可能有人做的比我成功，但我用我自己的方法做出來的模型，當用前 80% 的資料作 training、然後再用剩下的後 20% 資料作 validation，Accurarcy Rate 大約在 56% 。

```{python}
train_start = 0
train_end = int(np.floor(0.8*n))
test_start = train_end + 1
test_end = n
```

```{terminal}
$ python test.py
> Accuracy Rate:  0.5686
```

雖然用 90% 的資料作為學習樣本的 Accurarcy Rate 達到 68% 的程度，但是我覺得實際上會有 overfitting 的問題。

```{terminal}
$ python test.py
> Accuracy Rate:  0.6804
```

或許市場真的是隨機漫步的吧。
